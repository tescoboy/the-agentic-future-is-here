{% extends "base.html" %}

{% block title %}{% if product %}Edit Product{% else %}New Product{% endif %} - AdCP Demo{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h2>{% if product %}Edit Product{% else %}New Product{% endif %}</h2>
            </div>
            <div class="card-body">
                {% if errors.form %}
                <div class="alert alert-danger">
                    {{ errors.form }}
                </div>
                {% endif %}

                <form method="POST">
                    <div class="mb-3">
                        <label for="tenant_id" class="form-label">Tenant</label>
                        <select class="form-control {% if errors.tenant_id %}is-invalid{% endif %}" 
                                id="tenant_id" name="tenant_id" required>
                            <option value="">Select a tenant...</option>
                            {% for tenant in tenants %}
                            <option value="{{ tenant.id }}" {% if (product and product.tenant_id == tenant.id) or (not product and tenant_id and tenant.id == tenant_id) %}selected{% endif %}>
                                {{ tenant.name }}
                            </option>
                            {% endfor %}
                        </select>
                        {% if errors.tenant_id %}
                        <div class="invalid-feedback">{{ errors.tenant_id }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" class="form-control {% if errors.name %}is-invalid{% endif %}" 
                               id="name" name="name" value="{{ product.name if product else name or '' }}" required>
                        {% if errors.name %}
                        <div class="invalid-feedback">{{ errors.name }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control {% if errors.description %}is-invalid{% endif %}" 
                                  id="description" name="description" rows="3">{{ product.description if product else description or '' }}</textarea>
                        {% if errors.description %}
                        <div class="invalid-feedback">{{ errors.description }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="price_cpm" class="form-label">Price (CPM)</label>
                        <input type="number" step="0.01" min="0" class="form-control {% if errors.price_cpm %}is-invalid{% endif %}" 
                               id="price_cpm" name="price_cpm" value="{{ product.price_cpm if product else price_cpm or '' }}" required>
                        {% if errors.price_cpm %}
                        <div class="invalid-feedback">{{ errors.price_cpm }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="delivery_type" class="form-label">Delivery Type</label>
                        <input type="text" class="form-control {% if errors.delivery_type %}is-invalid{% endif %}" 
                               id="delivery_type" name="delivery_type" value="{{ product.delivery_type if product else delivery_type or '' }}" required>
                        {% if errors.delivery_type %}
                        <div class="invalid-feedback">{{ errors.delivery_type }}</div>
                        {% endif %}
                        <div class="form-text">e.g., guaranteed, nonguaranteed</div>
                    </div>

                    <div class="mb-3">
                        <label for="formats_json" class="form-label">Formats JSON</label>
                        <textarea class="form-control {% if errors.formats_json %}is-invalid{% endif %}" 
                                  id="formats_json" name="formats_json" rows="3">{{ product.formats_json if product else formats_json or '{}' }}</textarea>
                        {% if errors.formats_json %}
                        <div class="invalid-feedback">{{ errors.formats_json }}</div>
                        {% endif %}
                        <div class="form-text">e.g., {"sizes": ["300x250"]}</div>
                    </div>

                    <div class="mb-3">
                        <label for="targeting_json" class="form-label">Targeting JSON</label>
                        <textarea class="form-control {% if errors.targeting_json %}is-invalid{% endif %}" 
                                  id="targeting_json" name="targeting_json" rows="3">{{ product.targeting_json if product else targeting_json or '{}' }}</textarea>
                        {% if errors.targeting_json %}
                        <div class="invalid-feedback">{{ errors.targeting_json }}</div>
                        {% endif %}
                        <div class="form-text">e.g., {"geo": ["US", "CA"]}</div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="/products" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">
                            {% if product %}Update Product{% else %}Create Product{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

